---
title: "Math Lab"
author: "Andrew Chen"
date: "7/7/2018"
output: html_document
---

```{r}
library(dplyr)
library(magrittr)
```

###Cleaning Data
```{r}
lcd_data = read.csv('~/Desktop/Research/Extension_1.18.18_deidentified.csv', stringsAsFactors = FALSE)
comparisons = lcd_data %>% filter(random != 5089 & random != 9502 & random != 6531) %>% select(c(7:206, 397)) %>% slice(3:99)

for (i in 1:200) {
  comparisons[, i] = as.integer(unlist(comparisons[, i]))
}

comparisons = comparisons %>% filter(attcheck1_1 > 90 & attcheck3_1 > 90 & attcheck5_1 > 90 & attcheck7_1 > 90 & attcheck9_1 > 90)

comparisons = comparisons[-c(21,42,63,84,100,121,142,163,184,200)]
```

###Generating vectors of compared numbers
```{r}
numbers = c(5,14,16,9,29,8,11,20,18,21)
numbers2 = c(7,25,12,17,28,6,13,4,27,10)
num_mat = matrix(0,10,10)
for (i in 1:10) {
  num_mat[i,] = numbers
  numbers = numbers[c(2:10, 1)]
}

for (j in 1:10) {
  num_mat = cbind(num_mat, numbers2)
  numbers2 = numbers2[c(2:10,1)]
}

colnames(num_mat) = rep(NULL, 20)
```

###Generating vectors of compared fields
```{r}
field1 <- c(rep(1, 10), rep(c(1, 11), 5))
field2 <- c(2,16,3,17,4,18,5,19,6,20,11,rep(12:15, each = 2), 16)
```

###Changing columns into numbers that are compared
```{r}
x = 0
f1 = 1
f2 = 1
while (i + x <= 190) {
  if (x == 80 | x == 185) {
    for (i in 1:5) {
    colnames(comparisons)[i + x] = paste0(num_mat[i, field1[f1]], "/", num_mat[i, field2[f2]])
    }
    f1 = f1 + 1
    f2 = f2 + 1
    x = x + 5
    next
  } else {
    for (i in 1:10) {
    colnames(comparisons)[i + x] = paste0(num_mat[i, field1[f1]], "/", num_mat[i, field2[f2]])
    }
  }
  x = x + 10
  f1 = f1 + 1
  f2 = f2 + 1
  i = 5
}
```

###Creating Table of Demographics and Scores
```{r}
demo = lcd_data %>% slice(3:102) %>% filter(random != 5089 & random != 9502 & random != 6531)

for (i in 1:200) {
  demo[, i] = as.integer(unlist(demo[, i]))
}

demo = demo %>% filter(attcheck1_1 > 90 & attcheck3_1 > 90 & attcheck5_1 > 90 & attcheck7_1 > 90 & attcheck9_1 > 90) %>% select(367:395)

demo[, c(1,2,14:29)] = as.integer(unlist(demo[, c(1,2,14:29)]))

colnames(demo)[1] = "anxiety"
colnames(demo)[14:21] = paste0("r", 0:7)
colnames(demo)[22:29] = paste0("w", 0:7)

demo = demo %>% mutate(score = r0+r1+r2+r3+r4+r5+r6+r7-w0-w1-w2-w3-w4-w5-w6-w7)
```

###Attempt at Regression Analysis
```{r}
score_vs_anxiety = lm(demo$score ~ demo$anxiety)
summary(score_vs_anxiety)

score_vs_age = lm(demo$score ~ demo$age, demo)
summary(score_vs_age)

plot(demo$age, demo$score)
abline(score_vs_age)

plot(demo$anxiety, demo$score)
abline(score_vs_anxiety)
```

###analysisssssssss
```{r}
hist(demo$score, breaks = 10)
mean(demo$score)
median(demo$score)
sd(demo$score)
```

```{r}
hist(demo$anxiety)
mean(demo$anxiety)
median(demo$anxiety)
sd(demo$anxiety)
```

```{r}
gen_count = demo %>% count(gender)
eth_count = demo %>% count(ethnicity)
math_count = demo %>% count(math_freq)
sem_count = demo %>% count(college_semesters)
pro_count = demo %>% count(profession)
anx_count = demo %>% count(anxiety)
```

```{r}
demo %>% group_by(gender) %>% summarise(mean = mean(score)) %>% mutate(freq = gen_count$n) %>% arrange(desc(mean)) 
demo %>% group_by(ethnicity) %>% summarise(mean = mean(score)) %>% mutate(freq = eth_count$n) %>% arrange(desc(mean)) 
demo %>% group_by(college_semesters) %>% summarise(mean = mean(score)) %>% mutate(freq = sem_count$n)
demo %>% group_by(math_freq) %>% summarise(mean = mean(score)) %>% mutate(freq = math_count$n) %>% arrange(desc(mean)) 
demo %>% group_by(profession) %>% summarise(mean = mean(score)) %>% mutate(freq = pro_count$n) %>% arrange(desc(mean)) 
demo %>% group_by(anxiety) %>% summarise(mean = mean(score)) %>% mutate(freq = anx_count$n)
```

```{r}
#Mean scores of age groups
c1 = cut(demo$age, breaks = seq(20, 70, by = 10), include.lowest = T)
tapply(demo$score, c1, mean)
```

```{r}
lcd_data_w = read.csv('sim_data_with_weights.csv')
weights = lcd_data_w[,438:459]
```

```{r}
small_lm = lm(weights$small1 ~ weights$small2)
plot(weights$small1, weights$small2)
abline(small_lm)
summary(small_lm)
```

```{r}
med_lm = lm(weights$med1 ~ weights$med2)
plot(weights$med1, weights$med2)
abline(med_lm)
summary(med_lm)
```

```{r}
large_lm = lm(weights$large1 ~ weights$large2)
plot(weights$large1, weights$large2)
abline(large_lm)
summary(large_lm)
```

```{r}
even_lm = lm(weights$even1 ~ weights$even2)
plot(weights$even1, weights$even2)
abline(even_lm)
summary(even_lm)
```

```{r}
odd_lm = lm(weights$odd1 ~ weights$odd2)
plot(weights$odd1, weights$odd2)
abline(odd_lm)
summary(odd_lm)
```

```{r}
mult3_lm = lm(weights$mult31 ~ weights$mult32)
plot(weights$mult31, weights$mult32)
abline(mult3_lm)
summary(mult3_lm)
```

```{r}
mult4_lm = lm(weights$mult41 ~ weights$mult42)
plot(weights$mult41, weights$mult42)
abline(mult4_lm)
summary(mult4_lm)
```

```{r}
mult5_lm = lm(weights$mult51 ~ weights$mult52)
plot(weights$mult51, weights$mult52)
abline(mult5_lm)
summary(mult5_lm)
```

```{r}
mult7_lm = lm(weights$mult71 ~ weights$mult72)
plot(weights$mult71, weights$mult72)
abline(mult7_lm)
summary(mult7_lm)
```

```{r}
square_lm = lm(weights$square1 ~ weights$square2)
plot(weights$square1, weights$square2)
abline(square_lm)
summary(square_lm)
```

```{r}
prime_lm = lm(weights$prime1 ~ weights$prime2)
plot(weights$prime1, weights$prime2)
abline(prime_lm)
summary(prime_lm)
```

```{r}
avgs = c()
for (i in 1:22) {
  avgs[i] = mean(weights[,i])
  names(avgs)[i] = names(weights)[i]
}
avgs
```

```{r}
r_squared = c(summary(small_lm)$r.squared,
              summary(med_lm)$r.squared,
              summary(large_lm)$r.squared,
              summary(even_lm)$r.squared,
              summary(odd_lm)$r.squared,
              summary(mult3_lm)$r.squared,
              summary(mult4_lm)$r.squared,
              summary(mult5_lm)$r.squared,
              summary(mult7_lm)$r.squared,
              summary(square_lm)$r.squared,
              summary(prime_lm)$r.squared)
names(r_squared) = c('small', 'med', 'large', 'even', 'odd', 'mult3', 'mult4', 'mult5', 'mult7', 'square', 'prime')
sort(r_squared, decreasing = T)
```

```{r}
avg_avgs = c()
for (i in 1:11) {
  avg_avgs[i] = mean(c(avgs[2*i - 1], avgs[2*i]))
  names(avg_avgs)[i] = names(r_squared)[i]
}

sort(avg_avgs, decreasing = T)
```

```{r}
plot(weights$small1, resid(small_lm))
abline(0,0)
plot(weights$med1, resid(med_lm))
plot(weights$large1, resid(large_lm))
plot(weights$even1, resid(even_lm))
plot(weights$odd1, resid(odd_lm))
plot(weights$mult31, resid(mult3_lm))
plot(weights$mult41, resid(mult4_lm))
plot(weights$mult51, resid(mult5_lm))
plot(weights$mult71, resid(mult7_lm))
plot(weights$square1, resid(square_lm))
plot(weights$prime1, resid(prime_lm))
```

```{r}
qqnorm(resid(small_lm))
abline(0,1)
```

```{r}
plot(small_lm$fitted.values, resid(small_lm))
```

###Creating Table
```{r}
comp = data.frame(simrating = integer(),
                  I = integer(),
                  J = integer(),
                  I_measure = character(),
                  J_measure = character(),
                  ID = integer(),
                  stringsAsFactors = F)
for (i in 1:84) {
  part = comparisons[i, ]
  for (j in 1:190) {
    sim = as.integer(part[, j])
    nums = as.integer(unlist(strsplit(colnames(part)[j], "/")))
    lst = list()
    lst[[1]] = sim
    lst[[2]] = nums[1]
    lst[[3]] = nums[2]
    lst[[4]] = ifelse(is.element(nums[1], numbers), "A", "B")
    lst[[5]] = ifelse(is.element(nums[2], numbers), "A", "B")
    lst[[6]] = as.integer(part[, 191])
    comp[190 * (i-1)+j, ] = lst
  }
}
```

###Converting Table to CSV
```{r}
write.csv(comp, file = '~/Desktop/Research/Comparisons.csv', row.names = F)
```
